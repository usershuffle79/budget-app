<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

<title>Budget</title>
<link rel="icon" href="favicon.png" type="image/png">

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<link rel="stylesheet" href="style.css">
</head>

<body>

<header>
<div class="logo">
<a href="#">
<img src="logotransparent2.png" alt="Lauren on Shuffle">
</a>
</div>
</header>

<main>

<h1>Budget Form</h1>

<form id="budgetform">

<label>Category</label>
<select id="category" name="category" required>
<option value="">-- Select Category --</option>
<option value="income">Income</option>
<option value="home">Home</option>
<option value="living">Living</option>
<option value="pets">Pets</option>
<option value="tithings/donations">Tithing/Donations</option>
<option value="transportation">Transportation</option>
<option value="investments">Investments</option>
<option value="travel">Travel</option>
</select>

<br><br>

<label>Item</label>
<select id="item" name="item" required>
<option value="">-- Select a category first --</option>
</select>

<br><br>

<label>Note</label>
<textarea id="notes" name="notes" rows="1" placeholder="Type your notes..."></textarea>

<br><br>

<label>Date</label>
<input type="date" id="date" name="date">

<br><br>

<label>Amount</label>
<input id="amount" name="amount" type="text" inputmode="numeric" placeholder="0.00" />

<br><br>

<label>Type</label>
<select id="Type" name="Type" required>
<option value="">-- Select Type --</option>
<option value="bill">Bill</option>
<option value="subscription">Subscription</option>
<option value="other">Other</option>
<option value="income">Income</option>
</select>

<br><br>

<button type="submit">Save</button>

</form>
</main>

<script>
/* ---------- Dropdown Logic ---------- */
const optionsData = {
income: ["Income"],
home: ["Electricity","Entertainment/Gifts","Gasoline","HOA","Internet","Maintenance","Miscellaneous Home","Mortgage/Tax","Trash Pickup","Water/Sewer"],
living: ["Dining Out","Entertainment/Gifts","Groceries","Gym/Fitness","Medical","Miscellaneous Living"],
pets: ["Bird Food","Bird Supplies","Bird Vet","Dog Food","Dog Supplies","Dog Vet"],
"tithings/donations": ["Donation","Tithes"],
transportation: ["Car Gasoline","Maintenance","Insurance","Uber"],
investments: ["IRA","Savings"],
travel: ["Activities","Car Rental","Flight","Hotel","Miscellaneous"]
};

const categorySelect = document.getElementById("category");
const itemSelect = document.getElementById("item");
const typeSelect = document.getElementById("Type");

categorySelect.addEventListener("change", function () {
const selectedCategory = this.value;
itemSelect.innerHTML = "";

if (selectedCategory === "income") {
const incomeOption = document.createElement("option");
incomeOption.value = "income";
incomeOption.textContent = "Income";
itemSelect.appendChild(incomeOption);
itemSelect.value = "income";
typeSelect.value = "income";
itemSelect.disabled = true;
typeSelect.disabled = true;
} else {
itemSelect.disabled = false;
typeSelect.disabled = false;
typeSelect.value = "";

if (selectedCategory && optionsData[selectedCategory]) {
const defaultOption = document.createElement("option");
defaultOption.value = "";
defaultOption.textContent = "-- Select --";
itemSelect.appendChild(defaultOption);

optionsData[selectedCategory].forEach(item => {
const option = document.createElement("option");
option.value = item.toLowerCase().replace(/\s+/g, "-");
option.textContent = item;
itemSelect.appendChild(option);
});
}
}
});

/* ---------- Auto Date ---------- */
document.getElementById('date').value =
new Date().toISOString().split('T')[0];

/* ---------- Amount Formatting ---------- */
const input = document.getElementById("amount");
input.addEventListener("input", () => {
let digits = input.value.replace(/\D/g, "");
if (!digits) return input.value = "";
input.value = (parseInt(digits,10)/100).toFixed(2);
});

/* ---------- Google Sheets Submit ---------- */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxllVaFpEuNGkqXGQWuRm_MJQfHdvyuDnNrKp3_na4XChrs1IsX80VWDKr2tai8XVYf/exec";

document.getElementById("budgetform").addEventListener("submit", e => {
e.preventDefault();
const formData = new FormData(e.target);

if (categorySelect.value === "income") {
formData.set("item","income");
formData.set("Type","income");
}

fetch(SCRIPT_URL,{
method:"POST",
body:formData
})
.then(()=> {
alert("Saved!");
e.target.reset();
document.getElementById('date').value =
new Date().toISOString().split('T')[0];
})
.catch(err=>alert("Error: "+err.message));
});

/* ---------- Service Worker ---------- */
if ("serviceWorker" in navigator) {
navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>