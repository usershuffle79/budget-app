<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

<title>Shuffle Budget</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#ffffff">

<link rel="stylesheet" href="style.css">
</head>

<body>

<main>

<h1>Budget Form</h1>

<form id="budgetform">

<label>Category</label>
<select id="category" name="category" required>
<option value="">-- Select Category --</option>
<option value="income">Income</option>
<option value="home">Home</option>
<option value="living">Living</option>
<option value="pets">Pets</option>
<option value="tithings/donations">Tithing/Donations</option>
<option value="transportation">Transportation</option>
<option value="investments">Investments</option>
<option value="travel">Travel</option>
</select>

<br><br>

<label>Item</label>
<select id="item" name="item" required>
<option value="">-- Select a category first --</option>
</select>

<br><br>

<label>Note</label>
<textarea id="notes" name="notes" rows="1" placeholder="Type your notes..."></textarea>

<br><br>

<label>Date</label>
<input type="date" id="date" name="date">

<br><br>

<label>Amount</label>
<input id="amount" name="amount" type="text" inputmode="numeric" placeholder="0.00" />

<br><br>

<label>Type</label>
<select id="Type" name="Type" required>
<option value="">-- Select Type --</option>
<option value="bill">Bill</option>
<option value="subscription">Subscription</option>
<option value="other">Other</option>
<option value="investment">Investment</option>
<option value="income">Income</option>
</select>

<br><br>

<button type="submit">Preview</button>

</form>

<!-- RECEIPT PREVIEW -->
<div id="previewContainer" style="display:none; margin-top:30px;">
  <div class="receipt-card">
    <div class="receipt-header">
      <h2>Transaction Preview</h2>
      <div class="receipt-date" id="receiptDate"></div>
    </div>

    <div class="receipt-body" id="previewContent"></div>

    <div class="receipt-total">
      <span>Total</span>
      <span id="receiptAmount"></span>
    </div>

    <div class="receipt-actions">
      <button id="editBtn" class="secondary">Edit</button>
      <button id="confirmBtn" class="primary">Confirm</button>
    </div>
  </div>
</div>

<div id="successMessage" style="display:none; margin-top:30px;">
  <div class="receipt-success">
    âœ” Saved Successfully
  </div>
</div>

</main>

<script>

/* ---------- HAPTIC ---------- */
function subtleVibrate() {
  if (navigator.vibrate) {
    navigator.vibrate(20);
  }
}

/* ---------- DROPDOWN LOGIC ---------- */
const optionsData = {
    income: ["Income"],
    home: ["Electricity", "Gasoline", "HOA", "Internet", "Maintenance", "Miscellaneous Home", "Mortgage/Tax", "Trash Pickup", "Water/Sewer"],
    living: ["Dining Out", "Entertainment/Gifts", "Groceries", "Gym/Fitness", "Medical/Prescriptions/Vitamins", "Miscellaneous Living"],
    pets: ["Bird Food", "Bird Other", "Bird Supplies", "Bird Toys", "Bird Vet/Medical", "Dog Food", "Dog Other", "Dog Supplies", "Dog Toys", "Dog Vet/Medical"],
    "tithings/donations": ["Donation", "Tithes"],
    transportation: ["Car Gasoline", "Car Maintenance/Repair", "Insurance/Registration", "Miscellaneous Transportation", "Uber/RideShare"],
    investments: ["IRA", "Savings"],
    travel: ["Activities/Entertainment", "Car Rental", "Flight", "Hotel/Accomodations", "Miscellaneous Travel"]
};

const categorySelect = document.getElementById("category");
const itemSelect = document.getElementById("item");
const typeSelect = document.getElementById("Type");

categorySelect.addEventListener("change", function () {
const selectedCategory = this.value;
itemSelect.innerHTML = "";

if (selectedCategory === "income") {
const incomeOption = document.createElement("option");
incomeOption.value = "income";
incomeOption.textContent = "Income";
itemSelect.appendChild(incomeOption);
itemSelect.value = "income";
typeSelect.value = "income";
itemSelect.disabled = true;
typeSelect.disabled = true;
} else {
itemSelect.disabled = false;
typeSelect.disabled = false;
typeSelect.value = "";

if (selectedCategory && optionsData[selectedCategory]) {
const defaultOption = document.createElement("option");
defaultOption.value = "";
defaultOption.textContent = "-- Select --";
itemSelect.appendChild(defaultOption);

optionsData[selectedCategory].forEach(item => {
const option = document.createElement("option");
option.value = item.toLowerCase().replace(/\s+/g, "-");
option.textContent = item;
itemSelect.appendChild(option);
});
}
}
});

/* ---------- AUTO DATE ---------- */
document.getElementById('date').value =
new Date().toISOString().split('T')[0];

/* ---------- AMOUNT FORMAT ---------- */
const input = document.getElementById("amount");
input.addEventListener("input", () => {
let digits = input.value.replace(/\D/g, "");
if (!digits) return input.value = "";
input.value = (parseInt(digits,10)/100).toFixed(2);
});

/* ---------- RECEIPT PREVIEW ---------- */
const form = document.getElementById("budgetform");
const previewContainer = document.getElementById("previewContainer");
const previewContent = document.getElementById("previewContent");
const editBtn = document.getElementById("editBtn");
const confirmBtn = document.getElementById("confirmBtn");
const successMessage = document.getElementById("successMessage");

let pendingFormData = null;

form.addEventListener("submit", e => {
e.preventDefault();

const formData = new FormData(form);

if (categorySelect.value === "income") {
formData.set("item","income");
formData.set("Type","income");
}

pendingFormData = formData;

document.getElementById("receiptDate").textContent =
formData.get("date");

document.getElementById("receiptAmount").textContent =
"$" + formData.get("amount");

previewContent.innerHTML = `
<div><span>Category</span><span>${formData.get("category")}</span></div>
<div><span>Item</span><span>${formData.get("item")}</span></div>
<div><span>Type</span><span>${formData.get("Type")}</span></div>
<div><span>Note</span><span>${formData.get("notes") || "-"}</span></div>
`;

form.style.display = "none";
previewContainer.style.display = "block";

subtleVibrate();
});

/* ---------- EDIT ---------- */
editBtn.addEventListener("click", () => {
previewContainer.style.display = "none";
form.style.display = "block";
});

/* ---------- CONFIRM ---------- */
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzhkJOpfMbyIYsGy5KI5h0--3jyKFF1cEtYLqNMGwnUiK3kLwIx31gmGkPT0Kxzo27q/exec";

confirmBtn.addEventListener("click", () => {
fetch(SCRIPT_URL,{
method:"POST",
body:pendingFormData
})
.then(()=>{
previewContainer.style.display = "none";
successMessage.style.display = "block";

subtleVibrate();

setTimeout(()=>{
successMessage.style.display = "none";
form.reset();
document.getElementById('date').value =
new Date().toISOString().split('T')[0];
form.style.display = "block";
},1500);
})
.catch(err=>alert("Error: "+err.message));
});

/* ---------- SERVICE WORKER ---------- */
if ("serviceWorker" in navigator) {
navigator.serviceWorker.register("service-worker.js");
}

</script>

</body>
</html>







